# 进程

- 进程是指一个具有一定独立功能的程序在一个数据集合上的一次动态执行过程
- 进程包含了正在运行的一个程序的所有状态信息
  - 代码
  - 数据
  - 状态寄存器
  - 通用寄存器
  - 进程占用系统资源
- 动态性、并发性、独立性、制约性
- 进程和程序的区别
  - 进程是动态的，程序是静态的
    - 程序是有序代码的集合
    - 进程是程序的执行，进程有内核态和用户态
  - 进程是暂时的，程序是永久的
    - 进程是一个状态变化的过程
    - 程序可长久保存
  - 进程和程序的组成不同
    - 进程的组成包括程序、数据和进程控制块

## 进程控制块

- PCB Process Control Block
- PCB是进程存在的唯一标识
- 进程控制块的组织

## 进程状态

### 三状态进程模型

- 运行状态
- 就绪状态
- 等待状态

### 挂起进程模型

- 等待挂起
  - 进程在外存中并等待某事件的发生
- 就绪挂起
  - 进程在外存，只要进入内存就能执行
- 挂起
  - 把一个进程从内存转到外存
  - 等待到等待挂起
  - 就绪到就绪挂起
  - 运行到就绪挂起
- 激活

# 线程

- 线程是进程的一部分，描述指令流执行状态，他是进程中指令执行流的最小单元，是CPU调度的基本单位
- 进程是资源分配的单位，线程是CPU调度单位
- 进程拥有一个完整的资源平台，而线程只独享指令流执行的必要资源，如寄存器和栈
- 线程能减少并发执行的时间和空间开销
  - 线程的创建时间比进程短
  - 线程的终止时间比进程短
  - 同一进程内的线程切换时间比进程短
  - 同一进程的各线程间共享内存和文件资源，可不通过内核进行直接通信

## 用户线程

- POSIX Pthreads  Math C-threads Solaris threads
- 由一组用户级的线程函数库来完成线程的管理
- 不足
  - 线程发起系统调用而阻塞时，而整个进程进入等待
  - 不支持基于线程的处理机抢占

## 内核线程

- 基于线程的处理机调度

## 轻量级进程



# 原子操作

# 临界区

- 临界区的实现方式
  - 禁用中断
    - 整个系统都会为此停下来
    - 可能导致其他进程处于饥饿状态
    - 临界区可能很长，无法确定响应中断所需的时间(可能存在硬件影响)
  - 软件方法
    - Peterson算法
      - 满足线程Ti和Tj之间互斥的经典的基于软件的解决方法
    - Dekkers算法
    - Eisenberg和McGuire
  - 更高级的抽象方法
    - 硬件提供了一些同步原语，中断禁用、原子操作指令等

### 锁

- 抽象的数据结构
- 一个二进制的变量(锁定/解锁)
- Lock::Acquire()
- Lock::Release()

### 原子操作指令

- 现代CPU体系结构都提供一些特殊的原子操作指令
- 测试并置位Test-and-set指令
- 交换指令exchange

### TS指令实现自旋锁

- 忙等待消耗CPU
- 加入等待队列实现无忙等待

### 信号量

- 用信号量表示资源的数量